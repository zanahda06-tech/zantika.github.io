<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tugas Warna - Toko Online (K'CakeShop)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .card-img-top {
            height: 250px;
            object-fit: cover;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        .text-price {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .text-original-price {
            text-decoration: line-through;
            color: #6c757d;
            font-size: 0.9rem;
            margin-right: 10px;
        }
        .navbar-brand, .nav-link {
            transition: color 0.3s;
        }
        /* Style untuk status login */
        .user-status-text {
            cursor: pointer;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-warning shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-dark" href="#">K'CakeShop</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Produk</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#promoModal">
                            Promo üéâ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link user-status-text" id="account-link" href="#" data-bs-toggle="modal" data-bs-target="#accountModal">
                            <i class="bi bi-person-circle"></i> Masuk/Buat Akun
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas" aria-controls="cartOffcanvas">
                            üõí <span class="badge rounded-pill bg-danger" id="cart-count">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <h1 class="text-warning text-center mb-4 display-5 fw-bold" id="main-heading">„Çà„ÅÜ„Åì„Åù,Para Pencinta Kue üç™ </h1>
        
        <div class="mb-4">
            <div class="input-group">
                <span class="input-group-text bg-warning"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control" id="searchInput" onkeyup="searchProducts()" placeholder="Cari nama kue (misalnya: Nastar, Kastangel)..." aria-label="Cari Produk">
                <button class="btn btn-danger" onclick="document.getElementById('searchInput').value = ''; searchProducts();">Reset</button>
            </div>
        </div>
        <div class="row g-4" id="product-list"> 
            
            <div class="col-lg-4 col-md-6 col-12 product-card-col" data-original-price="25000">
                <div class="card border-0 shadow h-100">
                    <img src="https://i.pinimg.com/736x/f3/df/fa/f3dffaf7d5db005674918708092764f8.jpg" class="card-img-top" alt="Produk kue putri salju">
                    <div class="card-body bg-light">
                        <h5 class="card-title text-dark">Kue Putri Salju</h5>
                        <p class="text-price text-danger d-flex align-items-center" data-product="Kue Putri Salju">
                            <span class="price-display">Rp 25.000</span>
                        </p>
                        <p class="card-text text-secondary">Kue yang tidak terlalu manis dibalut dengan gula tepung yang manis membuat rasanya balance.</p>
                        <a href="#" class="btn btn-danger w-100 mt-2" 
                            data-bs-toggle="modal" 
                            data-bs-target="#addToCartModal"
                            data-produk-nama="Kue Putri Salju"
                            data-produk-raw-price="25000"
                            data-produk-deskripsi="Kue yang tidak terlalu manis dibalut dengan gula tepung yang manis membuat rasanya balance.">
                            Beli Sekarang
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 col-12 product-card-col" data-original-price="30000">
                <div class="card border-0 shadow h-100">
                    <img src="https://i.pinimg.com/736x/ac/75/fe/ac75fe78dbdf85f6b1a12c705dbd5b7e.jpg" class="card-img-top" alt="Produk Kue Kastangel">
                    <div class="card-body bg-light">
                        <h5 class="card-title text-dark">Kue Kastangel</h5>
                        <p class="text-price text-danger d-flex align-items-center" data-product="Kue Kastangel">
                            <span class="price-display">Rp 30.000</span>
                        </p>
                        <p class="card-text text-secondary">Kue yang tidak terlalu manis dicampur dengan keju membuat rasanya gurih.</p>
                        <a href="#" class="btn btn-danger w-100 mt-2" 
                            data-bs-toggle="modal" 
                            data-bs-target="#addToCartModal"
                            data-produk-nama="Kue Kastangel"
                            data-produk-raw-price="30000"
                            data-produk-deskripsi="Kue yang tidak terlalu manis dicampur dengan keju membuat rasanya gurih.">
                            Beli Sekarang
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 col-12 product-card-col" data-original-price="25000">
                <div class="card border-0 shadow h-100">
                    <img src="https://i.pinimg.com/736x/20/85/71/20857151b59c16adf380de94e716de7e.jpg" class="card-img-top" alt="Produk Kue Nastar">
                    <div class="card-body bg-light">
                        <h5 class="card-title text-dark">Kue Nastar</h5>
                        <p class="text-price text-danger d-flex align-items-center" data-product="Kue Nastar">
                            <span class="price-display">Rp 25.000</span>
                        </p>
                        <p class="card-text text-secondary">Kue yang manis dibalur dengan kuning telur kemudian dipanggang membuat kue terlihat mengkilap.</p>
                        <a href="#" class="btn btn-danger w-100 mt-2" 
                            data-bs-toggle="modal" 
                            data-bs-target="#addToCartModal"
                            data-produk-nama="Kue Nastar"
                            data-produk-raw-price="25000"
                            data-produk-deskripsi="Kue yang manis dibalur dengan kuning telur kemudian dipanggang membuat kue terlihat mengkilap.">
                            Beli Sekarang
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 col-12 product-card-col" data-original-price="25000">
                <div class="card border-0 shadow h-100">
                    <img src="https://i.pinimg.com/736x/a0/76/56/a076563a20e62425db1a16e802e4cef5.jpg" class="card-img-top" alt="Produk Lidah Kucing">
                    <div class="card-body bg-light">
                        <h5 class="card-title text-dark">Lidah Kucing</h5>
                        <p class="text-price text-danger d-flex align-items-center" data-product="Lidah Kucing">
                            <span class="price-display">Rp 25.000</span>
                        </p>
                        <p class="card-text text-secondary">Kue yang manis,tipis dan renyah .</p>
                        <a href="#" class="btn btn-danger w-100 mt-2" 
                            data-bs-toggle="modal" 
                            data-bs-target="#addToCartModal"
                            data-produk-nama="Lidah Kucing"
                            data-produk-raw-price="25000"
                            data-produk-deskripsi="Kue yang manis,tipis dan renyah .">
                            Beli Sekarang
                        </a>
                    </div>
                </div>
            </div> 
            
            <div class="col-lg-4 col-md-6 col-12 product-card-col" data-original-price="10000">
                <div class="card border-0 shadow h-100">
                    <img src="https://i.pinimg.com/736x/e0/97/a1/e097a1ef0fb4886a1894eb9fe73416d8.jpg" class="card-img-top" alt="Produk Klepon">
                    <div class="card-body bg-light">
                        <h5 class="card-title text-dark">Klepon</h5>
                        <p class="text-price text-danger d-flex align-items-center" data-product="Klepon">
                            <span class="price-display">Rp 10.000</span>
                        </p>
                        <p class="card-text text-secondary">Kue tradisional yang manis dibalur dengan kelapa parut yang gurih .</p>
                        <a href="#" class="btn btn-danger w-100 mt-2" 
                            data-bs-toggle="modal" 
                            data-bs-target="#addToCartModal"
                            data-produk-nama="Klepon"
                            data-produk-raw-price="10000"
                            data-produk-deskripsi="Kue tradisional yang manis dibalur dengan kelapa parut yang gurih .">
                            Beli Sekarang
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 col-12 product-card-col" data-original-price="2500">
                <div class="card border-0 shadow h-100">
                    <img src="https://i.pinimg.com/1200x/b3/e5/52/b3e552f696c7c0bfa84ef2d55871970c.jpg" class="card-img-top" alt="Produk Bolu Kukus">
                    <div class="card-body bg-light">
                        <h5 class="card-title text-dark">Bolu Kukus</h5>
                        <p class="text-price text-danger d-flex align-items-center" data-product="Bolu Kukus">
                            <span class="price-display">Rp 2.500</span>
                        </p>
                        <p class="card-text text-secondary">Kue tradisional yang manis dan lembut .</p>
                        <a href="#" class="btn btn-danger w-100 mt-2" 
                            data-bs-toggle="modal" 
                            data-bs-target="#addToCartModal"
                            data-produk-nama="Bolu Kukus"
                            data-produk-raw-price="2500"
                            data-produk-deskripsi="Kue tradisional yang manis dan lembut .">
                            Beli Sekarang
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div> 

    <div class="modal fade" id="accountModal" tabindex="-1" aria-labelledby="accountModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning" id="account-modal-header">
                    <h5 class="modal-title" id="accountModalLabel"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="account-modal-body">
                    </div>
                <div class="modal-footer" id="account-modal-footer">
                    </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="promoModal" tabindex="-1" aria-labelledby="promoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h5 class="modal-title text-white fw-bold" id="promoModalLabel">üéâ Promo Jumat Spesial 20% OFF!</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <h4 class="mb-3 text-dark" id="promo-status"></h4>
                    <h2 class="text-warning fw-bolder mb-4" id="countdown-timer">00 Hari 00:00:00</h2>
                    <p class="text-muted">Diskon 20% otomatis diterapkan pada semua harga hanya di Hari Jumat.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addToCartModal" tabindex="-1" aria-labelledby="addToCartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title" id="addToCartModalLabel">Masukkan ke Keranjang</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h4 id="modal-produk-nama" class="text-dark">Nama Produk</h4>
                    <p class="text-price text-danger mb-3" id="modal-produk-harga">Rp 0</p>
                    <p id="modal-produk-original-price" class="text-original-price"></p>

                    <h6>Deskripsi Produk:</h6>
                    <p id="modal-produk-deskripsi" class="text-secondary small">Detail deskripsi produk.</p>
                    <form>
                        <div class="mb-3">
                            <label for="quantityInput" class="form-label fw-bold">Kuantitas (Kelipatan) üî¢</label>
                            <input type="number" class="form-control" id="quantityInput" value="1" min="1" required>
                            <div class="form-text text-muted">Masukkan jumlah kue yang ingin Anda beli (minimal 1).</div>
                        </div>
                        <div class="mb-3">
                            <label for="commentsTextarea" class="form-label fw-bold">Komentar/Catatan Tambahan üìù</label>
                            <textarea class="form-control" id="commentsTextarea" rows="3" placeholder="Contoh: Tanpa gula di bagian atas, atau dikirim sore hari."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-danger btn-add-to-cart">üõí Masukkan ke Keranjang</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas" aria-labelledby="cartOffcanvasLabel">
      <div class="offcanvas-header bg-warning">
        <h5 class="offcanvas-title fw-bold" id="cartOffcanvasLabel">üõí Keranjang Belanja Anda</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <h6 class="text-muted">Produk yang dipilih:</h6>
        <ul class="list-group mb-4" id="cart-items-list">
          <li class="list-group-item text-center text-muted">Keranjang kosong nih! Ayo belanja.</li>
        </ul>

        <div class="card shadow-sm border-0">
            <div class="card-body bg-light">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Total:</h5>
                    <h4 class="mb-0 text-danger fw-bold" id="cart-total">Rp 0</h4>
                </div>
                <hr>
                <button class="btn btn-success w-100 fw-bold" id="checkout-btn">
                    <i class="bi bi-whatsapp"></i> Checkout Sekarang
                </button>
            </div>
        </div>

      </div>
    </div>

    <footer class="bg-dark py-3 mt-5">
        <div class="container">
            <p class="text-warning text-center mb-0">&copy; 2025 K'CakeShop. Maniskan Hari, Makan Manis.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Variabel global untuk status diskon
        let isFridayPromoActive = false;
        const DISCOUNT_PERCENTAGE = 0.20; // 20%
        const WHATSAPP_LINK = "https://wa.me/qr/BUKY3W77DVTSP1"; // Tautan WhatsApp target
        
        // 1. DATA STRUKTUR KERANJANG & USER
        let cart = [];
        let currentUser = null; // Menyimpan nama pengguna yang sedang aktif

        // Helper untuk memformat angka menjadi mata uang Rupiah
        function formatRupiah(number) {
            return 'Rp ' + Math.round(number).toLocaleString('id-ID');
        }

        // Fungsi diskon
        function calculateDiscountedPrice(originalPrice) {
            if (isFridayPromoActive) {
                return originalPrice * (1 - DISCOUNT_PERCENTAGE);
            }
            return originalPrice;
        }

        // --- FUNGSI LOCAL STORAGE (Akun & Keranjang) ---

        // Memuat status pengguna yang terakhir login
        function loadCurrentUser() {
            const user = localStorage.getItem('current_user');
            if (user) {
                currentUser = user;
                updateAccountStatus();
                loadCart(); // Muat keranjang jika ada user
            }
        }

        // Menyimpan keranjang ke Local Storage dengan kunci nama pengguna
        function saveCart() {
            if (currentUser) {
                localStorage.setItem(`cart_${currentUser}`, JSON.stringify(cart));
                console.log(`Keranjang untuk ${currentUser} disimpan.`);
            }
        }

        // Memuat keranjang dari Local Storage berdasarkan nama pengguna
        function loadCart() {
            if (currentUser) {
                const storedCart = localStorage.getItem(`cart_${currentUser}`);
                if (storedCart) {
                    cart = JSON.parse(storedCart);
                    console.log(`Keranjang untuk ${currentUser} dimuat.`);
                } else {
                    cart = []; // Kosongkan jika tidak ada keranjang tersimpan
                    console.log(`Keranjang baru dibuat untuk ${currentUser}.`);
                }
            } else {
                cart = []; // Kosongkan keranjang jika tidak ada user
            }
            renderCart();
        }

        // FUNGSI LOGIN
        function loginUser(username) {
            currentUser = username;
            localStorage.setItem('current_user', username);
            updateAccountStatus();
            loadCart(); // Otomatis muat keranjang lama atau buat baru
            
            // Tutup modal
            const modalElement = document.getElementById('accountModal');
            const modal = bootstrap.Modal.getInstance(modalElement);
            if (modal) modal.hide();
            
            alert(`Selamat datang, ${username}! Keranjang Anda telah dimuat.`);
        }

        // FUNGSI LOGOUT
        function logoutUser() {
            saveCart(); // Pastikan keranjang tersimpan sebelum logout
            currentUser = null;
            localStorage.removeItem('current_user');
            cart = []; // Kosongkan keranjang di RAM
            updateAccountStatus();
            renderCart();

            // Tutup modal
            const modalElement = document.getElementById('accountModal');
            const modal = bootstrap.Modal.getInstance(modalElement);
            if (modal) modal.hide();
            
            alert('Anda telah keluar. Keranjang Anda telah disimpan.');
        }

        // Memperbarui teks status di navbar
        function updateAccountStatus() {
            const accountLink = document.getElementById('account-link');
            if (currentUser) {
                accountLink.innerHTML = `<i class="bi bi-person-fill"></i> Halo, ${currentUser}!`;
                accountLink.setAttribute('data-bs-target', '#accountModal'); // Tetap ke modal yang sama
            } else {
                accountLink.innerHTML = `<i class="bi bi-person-circle"></i> Masuk/Buat Akun`;
                accountLink.setAttribute('data-bs-target', '#accountModal');
            }
        }

        // --- FUNGSI KERANJANG (Diperbarui untuk SaveCart) ---
        
        // Menghapus item dari keranjang
        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            saveCart(); // Simpan perubahan
            renderCart();
        }

        // Merender keranjang
        function renderCart() {
            const cartList = document.getElementById('cart-items-list');
            const cartTotalElement = document.getElementById('cart-total');
            const cartCountElement = document.getElementById('cart-count');
            const checkoutButton = document.getElementById('checkout-btn');
            let total = 0;
            
            cartList.innerHTML = '';
            cartCountElement.textContent = cart.length;

            if (cart.length === 0) {
                cartList.innerHTML = '<li class="list-group-item text-center text-muted">Keranjang kosong nih! Ayo belanja.</li>';
                checkoutButton.disabled = true;
            } else {
                checkoutButton.disabled = false;
                cart.forEach((item) => {
                    const pricePerItem = isFridayPromoActive ? calculateDiscountedPrice(item.originalRawPrice) : item.originalRawPrice;
                    const subtotal = pricePerItem * item.quantity;
                    total += subtotal;

                    const originalPriceHtml = isFridayPromoActive ? `<span class="text-original-price">${formatRupiah(item.originalRawPrice)}</span>` : '';

                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item d-flex justify-content-between align-items-center p-3'; 
                    
                    const notesHtml = item.notes ? `<p class="mb-0 small text-muted">Catatan: ${item.notes}</p>` : '';

                    listItem.innerHTML = `
                        <div class="me-auto">
                            <h6 class="mb-0 text-dark">${item.name} <span class="badge bg-warning text-dark">${item.quantity}x</span></h6>
                            <span class="text-secondary small">${originalPriceHtml} ${formatRupiah(pricePerItem)}/item</span>
                            ${notesHtml}
                        </div>
                        <div class="text-end">
                            <span class="fw-bold text-danger d-block mb-1">${formatRupiah(subtotal)}</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="removeFromCart(${item.id})">
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        </div>
                    `;
                    cartList.appendChild(listItem);
                });
            }

            cartTotalElement.textContent = formatRupiah(total);
        }

        // Menambah item ke keranjang
        function addToCart(name, originalRawPrice, quantity, notes) {
            const newItem = {
                id: Date.now(), 
                name: name,
                originalRawPrice: originalRawPrice, 
                quantity: parseInt(quantity),
                notes: notes
            };

            cart.push(newItem);
            saveCart(); // Simpan perubahan
            
            const modalElement = document.getElementById('addToCartModal');
            const modal = bootstrap.Modal.getInstance(modalElement);
            if (modal) modal.hide();

            renderCart();
            
            const offcanvasElement = document.getElementById('cartOffcanvas');
            const offcanvas = new bootstrap.Offcanvas(offcanvasElement);
            offcanvas.show();
        }

        // FUNGSI CHECKOUT (Tidak Berubah)
        function generateWhatsAppMessage() {
            if (cart.length === 0) {
                return "Halo, saya ingin memesan kue, tetapi keranjang belanja saya kosong. Mohon bantuan untuk memilihkan produk.";
            }

            let message = "Halo K'CakeShop! Saya ingin melakukan pemesanan berikut:\n\n";
            let totalAmount = 0;
            const priceStatus = isFridayPromoActive ? "(Harga sudah termasuk Diskon Jumat 20%)\n" : "";
            
            message += priceStatus;
            message += "--------------------------------------\n";

            cart.forEach((item, index) => {
                const pricePerItem = isFridayPromoActive ? calculateDiscountedPrice(item.originalRawPrice) : item.originalRawPrice;
                const subtotal = pricePerItem * item.quantity;
                totalAmount += subtotal;

                message += `${index + 1}. *${item.name}* (x${item.quantity})\n`;
                message += `   Harga Satuan: ${formatRupiah(pricePerItem)}\n`;
                message += `   Subtotal: ${formatRupiah(subtotal)}\n`;
                
                if (item.notes) {
                    message += `   Catatan: ${item.notes}\n`;
                }
                message += "\n";
            });

            message += "--------------------------------------\n";
            message += `üí∞ *TOTAL BELANJA:* ${formatRupiah(totalAmount)}\n`;
            message += "--------------------------------------\n\n";
            message += "Mohon konfirmasi pesanan dan detail pengiriman/pembayaran. Terima kasih!";
            
            return encodeURIComponent(message);
        }
        
        // FUNGSI LAIN (Pencarian & Timer)
        function searchProducts() { /* Logika Pencarian */ } // Dibiarkan kosong/tidak diubah untuk brevity
        function updateCountdownAndPrices() { /* Logika Timer dan Diskon */ } // Dibiarkan kosong/tidak diubah untuk brevity

        document.addEventListener('DOMContentLoaded', function () {
            
            // 0. MUAT STATUS USER SAAT APLIKASI DIMULAI
            loadCurrentUser();

            // A. LOGIKA MODAL AKUN (Login/Logout)
            const accountModal = document.getElementById('accountModal');
            const modalLabel = document.getElementById('accountModalLabel');
            const modalBody = document.getElementById('account-modal-body');
            const modalFooter = document.getElementById('account-modal-footer');

            accountModal.addEventListener('show.bs.modal', () => {
                if (currentUser) {
                    // Tampilan LOGOUT
                    modalLabel.textContent = 'Status Akun';
                    modalBody.innerHTML = `
                        <p class="lead">Anda saat ini masuk sebagai <strong>${currentUser}</strong>.</p>
                        <p class="text-muted">Keranjang Anda aman tersimpan dan akan dimuat kembali saat Anda masuk lagi.</p>
                    `;
                    modalFooter.innerHTML = `
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                        <button type="button" class="btn btn-danger" id="logout-btn">Keluar (Logout)</button>
                    `;
                    document.getElementById('logout-btn').addEventListener('click', logoutUser);

                } else {
                    // Tampilan LOGIN/BUAT AKUN
                    modalLabel.textContent = 'Masuk atau Buat Akun';
                    modalBody.innerHTML = `
                        <p>Masukkan nama pengguna Anda. Nama ini akan digunakan untuk menyimpan keranjang Anda.</p>
                        <div class="mb-3">
                            <label for="usernameInput" class="form-label">Nama Pengguna (tanpa spasi)</label>
                            <input type="text" class="form-control" id="usernameInput" required placeholder="Contoh: Budi_CakeLover">
                        </div>
                    `;
                    modalFooter.innerHTML = `
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-success" id="login-btn">Masuk / Simpan Akun</button>
                    `;

                    document.getElementById('login-btn').addEventListener('click', () => {
                        const username = document.getElementById('usernameInput').value.trim();
                        if (username.length >= 3) {
                            loginUser(username);
                        } else {
                            alert('Nama pengguna minimal 3 karakter!');
                        }
                    });
                }
            });

            // B. LOGIKA MODAL TAMBAH KE KERANJANG (Menggunakan logic lama)
            const cartModal = document.getElementById('addToCartModal');
            cartModal.addEventListener('show.bs.modal', event => {
                const button = event.relatedTarget;
                const nama = button.getAttribute('data-produk-nama');
                const rawPrice = parseFloat(button.getAttribute('data-produk-raw-price'));
                const deskripsi = button.getAttribute('data-produk-deskripsi');

                const discountedPrice = calculateDiscountedPrice(rawPrice);
                const finalPrice = isFridayPromoActive ? discountedPrice : rawPrice;

                const modalNama = cartModal.querySelector('#modal-produk-nama');
                const modalHarga = cartModal.querySelector('#modal-produk-harga');
                const modalOriginalPrice = cartModal.querySelector('#modal-produk-original-price');
                const modalDeskripsi = cartModal.querySelector('#modal-produk-deskripsi');
                const modalAddToCartBtn = cartModal.querySelector('.btn-add-to-cart');
                const quantityInput = cartModal.querySelector('#quantityInput');
                const commentsTextarea = cartModal.querySelector('#commentsTextarea');

                modalNama.textContent = nama;
                modalHarga.textContent = formatRupiah(finalPrice);
                modalDeskripsi.textContent = deskripsi;

                if (isFridayPromoActive) {
                    modalOriginalPrice.textContent = formatRupiah(rawPrice);
                    modalOriginalPrice.style.display = 'inline';
                } else {
                    modalOriginalPrice.textContent = '';
                    modalOriginalPrice.style.display = 'none';
                }

                modalAddToCartBtn.setAttribute('data-product-name', nama);
                modalAddToCartBtn.setAttribute('data-product-raw-price', rawPrice);
                quantityInput.value = 1;
                commentsTextarea.value = '';
            });

            // C. LOGIKA TOMBOL "MASUKKAN KE KERANJANG"
            const addToCartButton = cartModal.querySelector('.btn-add-to-cart'); 
            addToCartButton.addEventListener('click', function() {
                const name = this.getAttribute('data-product-name');
                const rawPrice = parseFloat(this.getAttribute('data-product-raw-price')); 
                const quantity = document.getElementById('quantityInput').value;
                const notes = document.getElementById('commentsTextarea').value.trim();
                
                if (parseInt(quantity) > 0) {
                    addToCart(name, rawPrice, quantity, notes); 
                } else {
                    alert('Kuantitas harus minimal 1.');
                }
            });
            
            // D. LOGIKA TOMBOL CHECKOUT
            const checkoutButton = document.getElementById('checkout-btn');
            checkoutButton.addEventListener('click', function() {
                if (cart.length > 0) {
                    const whatsappMessage = generateWhatsAppMessage();
                    const fullUrl = `${WHATSAPP_LINK}?text=${whatsappMessage}`;
                    window.open(fullUrl, '_blank');
                    
                    const offcanvasElement = document.getElementById('cartOffcanvas');
                    const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasElement);
                    if (offcanvas) offcanvas.hide();

                } else {
                    alert('Keranjang belanja Anda masih kosong. Silakan pilih produk terlebih dahulu!');
                }
            });

            // E. Inisialisasi Timer dan Harga
            updateCountdownAndPrices(); 
            setInterval(updateCountdownAndPrices, 1000); 
        });
        
        // Isi fungsi kosong (Pencarian & Timer) agar kode lengkap
        function searchProducts() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const productCards = document.querySelectorAll('#product-list .product-card-col');

            productCards.forEach(cardCol => {
                const cardTitle = cardCol.querySelector('.card-title');
                if (cardTitle) {
                    const productName = cardTitle.textContent || cardTitle.innerText;
                    
                    if (productName.toLowerCase().indexOf(filter) > -1) {
                        cardCol.style.display = "";
                    } else {
                        cardCol.style.display = "none";
                    }
                }
            });
        }
        
        function updateCountdownAndPrices() {
            const now = new Date();
            const day = now.getDay(); // 0 = Minggu, 5 = Jumat, 6 = Sabtu

            let nextFriday = new Date(now);
            nextFriday.setDate(now.getDate() + (5 + 7 - day) % 7); 
            nextFriday.setHours(0, 0, 0, 0);

            if (day === 5) {
                isFridayPromoActive = true;
                document.getElementById('promo-status').textContent = 'PROMO SEDANG BERLANGSUNG! Nikmati Diskon 20% üéâ';

                let endOfFriday = new Date(now);
                endOfFriday.setDate(now.getDate() + 1);
                endOfFriday.setHours(0, 0, 0, 0);

                const distance = endOfFriday - now;
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('countdown-timer').textContent = 
                    `00 Hari ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            } else {
                isFridayPromoActive = false;
                document.getElementById('promo-status').textContent = 'Promo akan datang pada Hari Jumat!';

                const distance = nextFriday - now;
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('countdown-timer').textContent = 
                    `${String(days).padStart(2, '0')} Hari ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }

            const productCards = document.querySelectorAll('#product-list .product-card-col');
            productCards.forEach(cardCol => {
                const originalPrice = parseFloat(cardCol.getAttribute('data-original-price'));
                const priceDisplayElement = cardCol.querySelector('.price-display');
                
                let originalPriceSpan = cardCol.querySelector('.text-original-price');
                if (originalPriceSpan) {
                    originalPriceSpan.remove();
                }

                if (isFridayPromoActive) {
                    const discountedPrice = calculateDiscountedPrice(originalPrice);
                    priceDisplayElement.textContent = formatRupiah(discountedPrice);

                    const newOriginalPriceSpan = document.createElement('span');
                    newOriginalPriceSpan.className = 'text-original-price';
                    newOriginalPriceSpan.textContent = formatRupiah(originalPrice);
                    
                    const parentPrice = priceDisplayElement.closest('.text-price');
                    parentPrice.prepend(newOriginalPriceSpan);

                } else {
                    priceDisplayElement.textContent = formatRupiah(originalPrice);
                }
            });

            renderCart();
        }
    </script>
</body>
</html>